<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arqut Services Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --accent-color: #60a5fa;
            --accent-hover: #3b82f6;
            --success-color: #34d399;
            --danger-color: #f87171;
            --warning-color: #fbbf24;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .refresh-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .filters {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="text"], select {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .services-grid {
            display: grid;
            gap: 1rem;
        }

        .service-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-color);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .service-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .service-id {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-family: monospace;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-enabled {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-disabled {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .service-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .detail-value {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-family: monospace;
        }

        .edge-badge {
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: var(--danger-color);
            margin-bottom: 1rem;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .api-key-status-section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .api-key-status-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .api-key-status {
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-weight: 600;
        }

        .api-key-status.configured {
            background: var(--success-color);
            color: white;
        }

        .api-key-status.not-configured {
            background: var(--danger-color);
            color: white;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: monospace;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .authorize-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .authorize-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .authorize-btn.authorized {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .authorize-btn.authorized:hover {
            background: var(--success-color);
            color: white;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .controls {
                width: 100%;
                justify-content: space-between;
            }

            .modal {
                width: 95%;
                margin: 1rem;
            }

            .modal-footer {
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .service-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <div class="logo">A</div>
                <h1>Arqut Services Dashboard</h1>
            </div>
            <div class="controls">
                <button class="authorize-btn" id="authorize-btn" onclick="openAuthModal()">
                    <span id="auth-icon">üîì</span>
                    <span id="auth-text">Authorize</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span>
                    <span id="theme-text">Dark</span>
                </button>
                <button class="refresh-btn" onclick="loadServices()">
                    <span>‚Üª</span>
                    <span>Refresh</span>
                </button>
            </div>
        </header>

        <!-- API Key Modal -->
        <div class="modal-overlay" id="auth-modal" onclick="closeAuthModalOnOverlay(event)">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">
                        <span>üîê</span>
                        <span>API Authorization</span>
                    </div>
                    <button class="modal-close" onclick="closeAuthModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="api-key-status-section">
                        <span class="api-key-status-label">Current Status</span>
                        <span class="api-key-status not-configured" id="modal-api-key-status">Not Configured</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="api-key-input">API Key</label>
                        <input
                            type="password"
                            id="api-key-input"
                            class="form-input"
                            placeholder="Enter your API key (e.g., arq_...)"
                        />
                        <div class="form-hint">
                            Your API key is stored securely in your browser's localStorage and is only used to authenticate API requests.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" onclick="clearAPIKey()">Clear Key</button>
                    <button class="btn btn-secondary" onclick="closeAuthModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveAPIKey()">Save & Authorize</button>
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="edge-filter">Filter by Edge ID</label>
                    <select id="edge-filter" onchange="applyFilters()">
                        <option value="">All Edges</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="service-search">Search Service Name</label>
                    <input type="text" id="service-search" placeholder="Type to search..." oninput="applyFilters()">
                </div>
                <div class="filter-group">
                    <label for="status-filter">Filter by Status</label>
                    <select id="status-filter" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="enabled">Enabled</option>
                        <option value="disabled">Disabled</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total Services</div>
                <div class="stat-value" id="stat-total">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Edges</div>
                <div class="stat-value" id="stat-edges">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Enabled Services</div>
                <div class="stat-value" id="stat-enabled">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Filtered Results</div>
                <div class="stat-value" id="stat-filtered">0</div>
            </div>
        </div>

        <div id="error-container"></div>
        <div id="services-container"></div>
    </div>

    <script>
        let allServices = [];
        let filteredServices = [];

        // API Key management
        function getAPIKey() {
            return localStorage.getItem('arqut_api_key');
        }

        function openAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.classList.add('active');
            updateModalStatus();
        }

        function closeAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.classList.remove('active');
            document.getElementById('api-key-input').value = '';
        }

        function closeAuthModalOnOverlay(event) {
            if (event.target.id === 'auth-modal') {
                closeAuthModal();
            }
        }

        function saveAPIKey() {
            const input = document.getElementById('api-key-input');
            const key = input.value.trim();

            if (!key) {
                alert('Please enter an API key');
                return;
            }

            localStorage.setItem('arqut_api_key', key);
            input.value = '';
            updateAPIKeyStatus();
            updateModalStatus();
            closeAuthModal();
            loadServices();
        }

        function clearAPIKey() {
            if (confirm('Are you sure you want to clear the API key?')) {
                localStorage.removeItem('arqut_api_key');
                updateAPIKeyStatus();
                updateModalStatus();
                closeAuthModal();
                allServices = [];
                filteredServices = [];
                updateStats();
                document.getElementById('services-container').innerHTML = '';
            }
        }

        function updateAPIKeyStatus() {
            const hasKey = !!getAPIKey();
            const authBtn = document.getElementById('authorize-btn');
            const authIcon = document.getElementById('auth-icon');
            const authText = document.getElementById('auth-text');

            if (hasKey) {
                authBtn.classList.add('authorized');
                authIcon.textContent = 'üîí';
                authText.textContent = 'Authorized';
            } else {
                authBtn.classList.remove('authorized');
                authIcon.textContent = 'üîì';
                authText.textContent = 'Authorize';
            }
        }

        function updateModalStatus() {
            const status = document.getElementById('modal-api-key-status');
            const hasKey = !!getAPIKey();

            if (hasKey) {
                status.textContent = 'Authorized ‚úì';
                status.className = 'api-key-status configured';
            } else {
                status.textContent = 'Not Configured';
                status.className = 'api-key-status not-configured';
            }
        }

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        }

        function updateThemeButton(theme) {
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');
            if (theme === 'dark') {
                icon.textContent = '‚òÄÔ∏è';
                text.textContent = 'Light';
            } else {
                icon.textContent = 'üåô';
                text.textContent = 'Dark';
            }
        }

        // Load services from API
        async function loadServices() {
            const container = document.getElementById('services-container');
            const errorContainer = document.getElementById('error-container');

            const apiKey = getAPIKey();
            if (!apiKey) {
                errorContainer.innerHTML = '<div class="error">‚ö†Ô∏è Please configure your API key above to view services.</div>';
                container.innerHTML = '';
                updateStats();
                return;
            }

            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading services...</p></div>';
            errorContainer.innerHTML = '';

            try {
                const response = await fetch('/api/v1/services', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid API key. Please check your API key and try again.');
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                allServices = data.data || [];
                populateEdgeFilter();
                applyFilters();

            } catch (error) {
                errorContainer.innerHTML = `<div class="error">Failed to load services: ${error.message}</div>`;
                container.innerHTML = '';
                updateStats();
            }
        }

        // Populate edge filter dropdown
        function populateEdgeFilter() {
            const edgeFilter = document.getElementById('edge-filter');
            const edges = [...new Set(allServices.map(s => s.edge_id))].sort();

            const currentValue = edgeFilter.value;
            edgeFilter.innerHTML = '<option value="">All Edges</option>';

            edges.forEach(edge => {
                const option = document.createElement('option');
                option.value = edge;
                option.textContent = edge;
                edgeFilter.appendChild(option);
            });

            if (edges.includes(currentValue)) {
                edgeFilter.value = currentValue;
            }
        }

        // Apply filters
        function applyFilters() {
            const edgeFilter = document.getElementById('edge-filter').value;
            const searchTerm = document.getElementById('service-search').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;

            filteredServices = allServices.filter(service => {
                const matchesEdge = !edgeFilter || service.edge_id === edgeFilter;
                const matchesSearch = !searchTerm || service.name.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter ||
                    (statusFilter === 'enabled' && service.enabled) ||
                    (statusFilter === 'disabled' && !service.enabled);

                return matchesEdge && matchesSearch && matchesStatus;
            });

            renderServices();
            updateStats();
        }

        // Render services
        function renderServices() {
            const container = document.getElementById('services-container');

            if (filteredServices.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div class="empty-state-text">No services found</div>
                        <p>Try adjusting your filters or check back later.</p>
                    </div>
                `;
                return;
            }

            const servicesHTML = filteredServices.map(service => `
                <div class="service-card">
                    <div class="edge-badge">Edge: ${escapeHtml(service.edge_id)}</div>
                    <div class="service-header">
                        <div>
                            <div class="service-name">${escapeHtml(service.name)}</div>
                            <div class="service-id">ID: ${escapeHtml(service.id)}</div>
                        </div>
                        <span class="status-badge ${service.enabled ? 'status-enabled' : 'status-disabled'}">
                            ${service.enabled ? '‚úì Enabled' : '‚óã Disabled'}
                        </span>
                    </div>
                    <div class="service-details">
                        <div class="detail-item">
                            <div class="detail-label">Protocol</div>
                            <div class="detail-value">${escapeHtml(service.protocol || 'tcp')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Tunnel Port</div>
                            <div class="detail-value">${service.tunnel_port || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Local Host</div>
                            <div class="detail-value">${escapeHtml(service.local_host || 'localhost')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Local Port</div>
                            <div class="detail-value">${service.local_port || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Created</div>
                            <div class="detail-value">${formatDate(service.created_at)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Updated</div>
                            <div class="detail-value">${formatDate(service.updated_at)}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="services-grid">${servicesHTML}</div>`;
        }

        // Update statistics
        function updateStats() {
            const uniqueEdges = new Set(allServices.map(s => s.edge_id)).size;
            const enabledCount = allServices.filter(s => s.enabled).length;

            document.getElementById('stat-total').textContent = allServices.length;
            document.getElementById('stat-edges').textContent = uniqueEdges;
            document.getElementById('stat-enabled').textContent = enabledCount;
            document.getElementById('stat-filtered').textContent = filteredServices.length;
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Initialize
        initTheme();
        updateAPIKeyStatus();
        loadServices();

        // Auto-refresh every 30 seconds
        setInterval(loadServices, 30000);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAuthModal();
            }
        });
    </script>
</body>
</html>
